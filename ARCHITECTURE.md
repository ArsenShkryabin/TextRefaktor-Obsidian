# Архитектура проекта

## Структура файлов

```
проект_расширение_обсидиан/
├── main.ts                 # Главный файл плагина (точка входа)
├── manifest.json           # Метаданные плагина для Obsidian
├── package.json            # Зависимости и скрипты npm
├── tsconfig.json           # Конфигурация TypeScript
├── esbuild.config.mjs      # Конфигурация сборки
├── styles.css              # Стили для UI компонентов
├── README.md               # Основная документация
├── QUICKSTART.md           # Быстрый старт
├── ARCHITECTURE.md         # Этот файл
└── src/
    ├── types.ts            # TypeScript типы и интерфейсы
    ├── api/
    │   └── AIService.ts    # Сервис для работы с AI API
    ├── ui/
    │   └── EnhancementModal.ts  # Модальное окно предпросмотра
    └── settings/
        └── SettingsTab.ts  # Вкладка настроек плагина
```

## Компоненты

### main.ts
Главный файл плагина, который:
- Инициализирует плагин
- Регистрирует команды
- Управляет настройками
- Координирует работу всех компонентов

### src/types.ts
Определяет:
- `PluginSettings` - интерфейс настроек плагина
- `EnhancementMode` - режимы улучшения текста (IMPROVE/ENHANCE)
- `DEFAULT_SETTINGS` - значения по умолчанию

### src/api/AIService.ts
Сервис для взаимодействия с AI API:
- Построение промптов для разных режимов
- Отправка запросов к API
- Обработка ответов и ошибок
- Поддержка разных провайдеров (расширяемо)

### src/ui/EnhancementModal.ts
Модальное окно для:
- Отображения улучшенного текста
- Редактирования результата перед применением
- Подтверждения или отмены изменений

### src/settings/SettingsTab.ts
Вкладка настроек для:
- Настройки API ключа
- Выбора провайдера
- Настройки параметров модели
- Управления другими опциями

## Поток данных

1. **Пользователь выделяет текст** → Вызывает команду
2. **main.ts** → Получает выделенный текст из редактора
3. **AIService** → Формирует промпт и отправляет запрос к API
4. **AI API** → Обрабатывает запрос и возвращает улучшенный текст
5. **EnhancementModal** → Показывает результат пользователю
6. **Пользователь** → Подтверждает или редактирует результат
7. **main.ts** → Применяет изменения в редакторе

## Расширяемость

Архитектура спроектирована для легкого расширения:

- **Новые провайдеры API**: Добавьте метод в `AIService.ts`
- **Новые режимы улучшения**: Добавьте значение в `EnhancementMode`
- **Новые UI компоненты**: Создайте файлы в `src/ui/`
- **Дополнительные настройки**: Расширьте `PluginSettings` и `SettingsTab`

## Принципы проектирования

1. **Разделение ответственности**: Каждый модуль отвечает за свою область
2. **Типобезопасность**: Использование TypeScript для предотвращения ошибок
3. **Расширяемость**: Легко добавлять новые функции
4. **Пользовательский опыт**: Интуитивный интерфейс и понятные сообщения об ошибках

